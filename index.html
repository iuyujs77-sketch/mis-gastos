<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance √âlite 360 v6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #0b141e; color: #fff; }
        .card-white { background-color: #ffffff; border-radius: 20px; padding: 18px; color: #1a202c; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .card-dark { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 25px; padding: 18px; }
        .input-premium { background: transparent; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 10px 0; width: 100%; outline: none; color: #fff; font-size: 14px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-up { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        nav { background-color: #0b141e; border-top: 1px solid rgba(255,255,255,0.1); }
        .tab-active { border-bottom: 2px solid #d4af37; color: #d4af37; }
        input[type="date"], input[type="month"] { color-scheme: dark; }
    </style>
</head>
<body class="pb-28">
    <div id="app"></div>

    <nav class="fixed bottom-0 left-0 right-0 px-8 py-4 flex justify-between items-center z-50 shadow-2xl">
        <button onclick="cambiarVista('home')" class="flex flex-col items-center gap-1 opacity-50 focus:opacity-100"><span class="text-xl">üè†</span><span class="text-[9px] font-bold uppercase text-slate-400">Inicio</span></button>
        <button onclick="cambiarVista('corte')" class="flex flex-col items-center gap-1 opacity-50 focus:opacity-100"><span class="text-xl">üìä</span><span class="text-[9px] font-bold uppercase text-slate-400">Corte</span></button>
        <button onclick="cambiarVista('metas')" class="flex flex-col items-center gap-1 opacity-50 focus:opacity-100"><span class="text-xl">üéØ</span><span class="text-[9px] font-bold uppercase text-slate-400">Metas</span></button>
        <button onclick="cambiarVista('config')" class="flex flex-col items-center gap-1 opacity-50 focus:opacity-100"><span class="text-xl">‚öôÔ∏è</span><span class="text-[9px] font-bold uppercase text-slate-400">Ajustes</span></button>
    </nav>

    <script>
        // --- DATA ESTRUCTURADA ---
        let config = JSON.parse(localStorage.getItem('e360_v6_config')) || {
            nombre: "Usuario",
            cuentas: [
                { id: 1, nombre: 'Efectivo', tipo: 'debito' },
                { id: 2, nombre: 'Amex Gold', tipo: 'credito' }
            ],
            categorias: ['Comida', 'S√∫per', 'Gasolina', 'Gym', 'Pasto'],
            recurrentes: []
        };
        let movimientos = JSON.parse(localStorage.getItem('e360_v6_movs')) || [];
        let vistaActual = 'home';
        let tipoActual = 'gasto';
        let filtroCorte = { periodo: 'mes', fecha: new Date().toISOString().split('T')[0] };

        function render() {
            const container = document.getElementById('app');
            if (vistaActual === 'corte') renderCorte(container);
            else if (vistaActual === 'metas') renderMetas(container);
            else if (vistaActual === 'config') renderConfig(container);
            else renderHome(container);
        }

        function renderHome(c) {
            const stats = calcularStats();
            c.innerHTML = `
                <div class="pt-10 px-8 mb-12 animate-up">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-12 h-12 rounded-full border border-gold-text/50 flex items-center justify-center bg-slate-800 font-bold gold-text text-xl">F</div>
                        <p class="text-[10px] font-bold gold-text uppercase tracking-widest italic">Intelligence System</p>
                    </div>
                    <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Patrimonio Neto</p>
                    <h2 class="text-5xl font-extrabold text-white tracking-tighter mb-4">$${stats.totalBalance.toLocaleString()}</h2>
                </div>

                <div class="max-w-md mx-auto px-5 space-y-8 animate-up">
                    <div class="overflow-x-auto no-scrollbar flex gap-4">
                        ${config.cuentas.map(cta => {
                            const bal = stats.porCuenta[cta.nombre] || 0;
                            const isCred = cta.tipo === 'credito';
                            return `<div class="min-w-[170px] card-white flex flex-col justify-between h-40 shadow-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-[10px] font-extrabold text-slate-800 uppercase">${cta.nombre}</span>
                                    <span class="text-[10px]">${isCred ? 'üí≥' : 'üíµ'}</span>
                                </div>
                                <div>
                                    <p class="text-[7px] text-slate-400 font-bold mb-1 uppercase">${isCred ? 'DEUDA ACUMULADA' : 'DISPONIBLE'}</p>
                                    <p class="text-xl font-extrabold ${isCred && bal > 0 ? 'text-red-600' : 'text-slate-900'}">$${bal.toLocaleString()}</p>
                                    <p class="text-[6px] text-slate-400 mt-2 border-t pt-1 font-bold uppercase">Movs: ${stats.countCta[cta.nombre] || 0}</p>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>

                    <div class="card-dark space-y-4 shadow-2xl border border-white/5">
                        <div class="flex bg-white/5 rounded-2xl p-1 border border-white/10">
                            <button onclick="tipoActual='gasto'; render();" class="flex-1 py-3 rounded-xl text-[10px] font-bold ${tipoActual === 'gasto' ? 'bg-white text-slate-900' : 'text-slate-400'} uppercase">Gasto</button>
                            <button onclick="tipoActual='ingreso'; render();" class="flex-1 py-3 rounded-xl text-[10px] font-bold ${tipoActual === 'ingreso' ? 'bg-white text-slate-900' : 'text-slate-400'} uppercase">Ingreso</button>
                            <button onclick="tipoActual='pago'; render();" class="flex-1 py-3 rounded-xl text-[10px] font-bold ${tipoActual === 'pago' ? 'bg-gold-bg text-slate-900' : 'text-slate-400'} uppercase">Pagar Tarjeta</button>
                        </div>
                        
                        <input type="number" id="monto" inputmode="decimal" placeholder="0.00" class="input-premium text-4xl font-extrabold text-white text-center">
                        
                        <div class="grid grid-cols-2 gap-4">
                            ${tipoActual === 'pago' ? `
                                <select id="metodo_origen" class="input-premium"><option disabled selected>Desde (D√©bito)</option>${config.cuentas.filter(ct=>ct.tipo==='debito').map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select>
                                <select id="metodo" class="input-premium"><option disabled selected>Hacia (Cr√©dito)</option>${config.cuentas.filter(ct=>ct.tipo==='credito').map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select>
                            ` : `
                                <select id="cat" class="input-premium"><option disabled selected>Categor√≠a</option>${(tipoActual==='gasto'?config.categorias:['N√≥mina','Bono','Venta']).map(c=>`<option value="${c}">${c}</option>`)}</select>
                                <select id="metodo" class="input-premium"><option disabled selected>Cuenta</option>${config.cuentas.map(m=>`<option value="${m.nombre}">${m.nombre}</option>`)}</select>
                            `}
                        </div>
                        <input type="datetime-local" id="fecha_mov" class="input-premium">
                        <button onclick="registrar()" class="w-full gold-bg text-slate-900 py-4 rounded-2xl font-bold uppercase text-[10px] shadow-lg">Confirmar Movimiento</button>
                    </div>
                </div>`;
            document.getElementById('fecha_mov').value = new Date().toISOString().slice(0, 16);
        }

        function renderCorte(c) {
            const data = calcularAuditoria(filtroCorte.periodo, filtroCorte.fecha);
            c.innerHTML = `
                <div class="p-8 animate-up">
                    <h1 class="text-2xl font-extrabold text-white mb-6 uppercase text-center">Auditor√≠a Din√°mica</h1>
                    
                    <div class="flex gap-2 mb-6">
                        <button onclick="filtroCorte.periodo='dia'; render();" class="flex-1 py-2 text-[9px] font-bold uppercase border border-white/10 rounded-lg ${filtroCorte.periodo === 'dia' ? 'gold-bg text-dark-bg' : 'opacity-40'}">D√≠a</button>
                        <button onclick="filtroCorte.periodo='semana'; render();" class="flex-1 py-2 text-[9px] font-bold uppercase border border-white/10 rounded-lg ${filtroCorte.periodo === 'semana' ? 'gold-bg text-dark-bg' : 'opacity-40'}">Semana</button>
                        <button onclick="filtroCorte.periodo='mes'; render();" class="flex-1 py-2 text-[9px] font-bold uppercase border border-white/10 rounded-lg ${filtroCorte.periodo === 'mes' ? 'gold-bg text-dark-bg' : 'opacity-40'}">Mes</button>
                    </div>

                    <div class="mb-8">
                        <label class="text-[9px] font-bold uppercase text-slate-500 ml-2">Seleccionar Fecha de An√°lisis</label>
                        <input type="${filtroCorte.periodo === 'mes' ? 'month' : 'date'}" value="${filtroCorte.fecha.slice(0, filtroCorte.periodo === 'mes' ? 7 : 10)}" 
                               onchange="filtroCorte.fecha=this.value; render();" class="input-premium text-center border border-white/10 rounded-xl py-4 mt-2">
                    </div>

                    <div class="space-y-6">
                        <div class="card-white text-center">
                            <p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Balance del Periodo</p>
                            <h3 class="text-4xl font-extrabold ${data.neto >= 0 ? 'text-green-600' : 'text-red-600'}">$${data.neto.toLocaleString()}</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="card-dark border-l-4 border-green-500"><p class="text-[8px] text-slate-500 uppercase">Ingresos</p><p class="font-bold">$${data.in.toLocaleString()}</p></div>
                            <div class="card-dark border-l-4 border-red-500"><p class="text-[8px] text-slate-500 uppercase">Gastos</p><p class="font-bold">$${data.out.toLocaleString()}</p></div>
                        </div>
                    </div>
                </div>`;
        }

        function renderConfig(c) {
            c.innerHTML = `
                <div class="p-8 animate-up">
                    <h1 class="text-2xl font-extrabold text-white mb-8 text-center uppercase">Ajustes √âlite</h1>
                    <div class="space-y-6">
                        <div class="card-white">
                            <p class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">Cuentas y Tarjetas</p>
                            <input type="text" id="newCtaNombre" placeholder="Nombre" class="w-full p-3 border-b mb-3 text-sm outline-none">
                            <select id="newCtaTipo" class="w-full p-3 border-b mb-4 text-sm outline-none">
                                <option value="debito">D√©bito / Efectivo</option>
                                <option value="credito">Tarjeta de Cr√©dito</option>
                            </select>
                            <button onclick="addCuenta()" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold text-[10px] uppercase">A√±adir Cuenta</button>
                            <div class="mt-4 flex flex-wrap gap-2">
                                ${config.cuentas.map((cta, i) => `<span class="bg-slate-100 text-[9px] font-bold px-3 py-2 rounded-lg">${cta.nombre} (${cta.tipo}) <button onclick="removeItem('cuentas', ${i})" class="text-red-500 ml-1">√ó</button></span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        // --- MOTOR INTELIGENTE ---
        function registrar() {
            const m = parseFloat(document.getElementById('monto').value);
            const f = document.getElementById('fecha_mov').value;
            const met = document.getElementById('metodo').value;
            
            if(!m || !met) return alert('Llene monto y cuenta');

            if(tipoActual === 'pago'){
                const origen = document.getElementById('metodo_origen').value;
                movimientos.unshift({ monto: m, tipo: 'gasto', cat: 'Pago Tarjeta', metodo: origen, fecha: f });
                movimientos.unshift({ monto: m, tipo: 'ingreso', cat: 'Abono Deuda', metodo: met, fecha: f });
            } else {
                movimientos.unshift({ monto: m, tipo: tipoActual, cat: document.getElementById('cat').value, metodo: met, desc: document.getElementById('desc').value, fecha: f });
            }
            save(); render();
        }

        function calcularGlobal() {
            let total = 0, inC = {}, outC = {}, countCta = {};
            movimientos.forEach(m => {
                const monto = parseFloat(m.monto);
                const cta = config.cuentas.find(c => c.nombre === m.metodo);
                if (!cta) return;
                
                countCta[m.metodo] = (countCta[m.metodo] || 0) + 1;
                if (m.tipo === 'ingreso') {
                    if (cta.tipo === 'debito') total += monto;
                    inC[m.metodo] = (inC[m.metodo] || 0) + monto;
                } else {
                    if (cta.tipo === 'debito') total -= monto;
                    outC[m.metodo] = (outC[m.metodo] || 0) + monto;
                }
            });
            // La "porCuenta" para cr√©dito debe ser el balance neto de la tarjeta (lo gastado menos lo abonado)
            let porCuenta = {};
            config.cuentas.forEach(c => {
                if (c.tipo === 'credito') porCuenta[c.nombre] = (outC[c.nombre] || 0) - (inC[c.nombre] || 0);
                else porCuenta[c.nombre] = (inC[c.nombre] || 0) - (outC[c.nombre] || 0);
            });
            return { totalBalance: total, ingresosPorCuenta: inC, gastosPorCuenta: outC, porCuenta, countCta };
        }

        function calcularAuditoria(periodo, fechaRef) {
            let incomes = 0, outcomes = 0, porCat = {};
            const ref = new Date(fechaRef);
            movimientos.forEach(m => {
                const mDate = new Date(m.fecha);
                let match = false;
                if (periodo === 'dia') match = mDate.toDateString() === ref.toDateString();
                else if (periodo === 'mes') match = mDate.getMonth() === ref.getMonth() && mDate.getFullYear() === ref.getFullYear();
                else if (periodo === 'semana') match = Math.abs((ref - mDate) / 864e5) <= 7;

                if (match) {
                    if (m.tipo === 'ingreso') incomes += parseFloat(m.monto);
                    else { outcomes += parseFloat(m.monto); porCat[m.cat] = (porCat[m.cat] || 0) + parseFloat(m.monto); }
                }
            });
            return { in: incomes, out: outcomes, neto: incomes - outcomes, porCat };
        }

        function addCuenta() {
            const nom = document.getElementById('newCtaNombre').value;
            const tip = document.getElementById('newCtaTipo').value;
            if (nom) { config.cuentas.push({ id: Date.now(), nombre: nom, tipo: tip }); save(); render(); }
        }

        function save() { localStorage.setItem('e360_v6_config', JSON.stringify(config)); localStorage.setItem('e360_v6_movs', JSON.stringify(movimientos)); }
        function cambiarVista(v) { vistaActual = v; render(); }
        function removeItem(key, i) { config[key].splice(i, 1); save(); render(); }
        function renderMetas(c) { c.innerHTML = '<div class="p-8 text-center">üéØ Pantalla de Metas Pr√≥ximamente</div>'; }
        
        render();
    </script>
</body>
</html>
